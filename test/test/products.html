<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>VMCloud — Produits (DB)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body{background:#09090b;color:#fafafa;font-family:Inter,system-ui,sans-serif;font-weight:300}
      .card{background:rgba(24,24,27,.6);border:1px solid rgba(63,63,70,.2);backdrop-filter:blur(8px);transition:all .3s}
      .card:hover{border-color:rgba(113,113,122,.3)}
      .mono{font-variant-ligatures:none}
      .json{white-space:pre-wrap;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:.85rem}
      .table th,.table td{border-bottom:1px solid rgba(63,63,70,.3)}
      .badge{background:#fff;color:#0a0a0a;padding:.125rem .5rem;font-size:.7rem;letter-spacing:.05em}
    </style>
  </head>
  <body>
    <header class="sticky top-0 z-10 backdrop-blur-md bg-zinc-950/80 border-b border-zinc-800/50">
      <div class="container mx-auto px-6 py-4 flex items-center justify-between">
        <div class="text-lg tracking-wide">VMCloud — Produits (DB)</div>
        <div class="text-xs text-zinc-500">Ouvre ce fichier directement dans le navigateur</div>
      </div>
    </header>
    <main class="container mx-auto px-6 py-10 space-y-6" id="app">
      <div class="card p-6">
        <h1 class="text-xl font-light mb-2">Chargement…</h1>
        <p class="text-zinc-400">Je charge <code class="mono">products.data.json</code>.</p>
        <p class="text-zinc-500 text-sm mt-2">Si ce fichier n'existe pas, génère-le avec: <code class="mono">node test/generate-products-html.mjs</code></p>
      </div>
    </main>
    <script>
      async function load() {
        const app = document.getElementById('app');
        try {
          const res = await fetch('products.data.json', { cache: 'no-store' });
          if (!res.ok) throw new Error('products.data.json introuvable');
          const products = await res.json();
          app.innerHTML = renderProducts(products);
        } catch (e) {
          app.innerHTML = `
            <div class="card p-6">
              <h1 class="text-xl font-light mb-2">Aucune donnée trouvée</h1>
              <p class="text-zinc-400">Génère d'abord le snapshot DB:</p>
              <pre class="json mt-3">node test/generate-products-html.mjs</pre>
            </div>
          `;
        }
      }

      function escapeHtml(s){return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#039;');}

      function renderProducts(products){
        if (!products || products.length===0) {
          return `<div class="card p-6">Aucun produit.</div>`;
        }
        return products.map(p => {
          const specs = p.specsJson ? `<pre class="json text-zinc-300">${escapeHtml(JSON.stringify(p.specsJson, null, 2))}</pre>` : '<div class="text-zinc-500 text-sm">—</div>';
          const pricing = p.pricingJson ? `<pre class="json text-zinc-300">${escapeHtml(JSON.stringify(p.pricingJson, null, 2))}</pre>` : '<div class="text-zinc-500 text-sm">—</div>';
          const features = p.featuresJson ? `<pre class="json text-zinc-300">${escapeHtml(JSON.stringify(p.featuresJson, null, 2))}</pre>` : '<div class="text-zinc-500 text-sm">—</div>';
          const instances = (p.instances||[]).map(i=>`
            <tr>
              <td class="py-1 pr-3"><code class="mono">${escapeHtml(i.id)}</code></td>
              <td class="py-1 pr-3"><span class="badge">${escapeHtml(i.status)}</span></td>
              <td class="py-1 pr-3">${escapeHtml(i.name || '—')}</td>
              <td class="py-1 pr-3">${escapeHtml(i.hostname || '—')}</td>
              <td class="py-1 pr-3 text-zinc-400">${escapeHtml(i.userId||'')}</td>
              <td class="py-1 text-zinc-400">${i.createdAt ? escapeHtml(new Date(i.createdAt).toLocaleString()) : ''}</td>
            </tr>
          `).join('');
          return `
            <section class="card p-6 md:p-8">
              <div class="flex items-start justify-between gap-6">
                <div>
                  <div class="text-xs tracking-widest text-zinc-500">${escapeHtml(p.category || 'PRODUIT')}</div>
                  <h2 class="mt-1 text-2xl font-light">${escapeHtml(p.name)} <span class="text-zinc-500 text-sm">/${escapeHtml(p.slug)}</span></h2>
                  <p class="mt-2 text-zinc-400 max-w-prose">${escapeHtml(p.description || '')}</p>
                </div>
                <div class="text-right text-sm text-zinc-400">
                  <div>Statut: <span class="badge">${escapeHtml(p.status)}</span></div>
                  <div class="mt-1">Ordre: ${p.sortOrder ?? ''}</div>
                  <div class="mt-1">Instances liées: ${p._count?.instances ?? (p.instances?.length ?? 0)}</div>
                  <div class="mt-1">Créé: ${p.createdAt ? escapeHtml(new Date(p.createdAt).toLocaleString()) : ''}</div>
                  <div>MAJ: ${p.updatedAt ? escapeHtml(new Date(p.updatedAt).toLocaleString()) : ''}</div>
                </div>
              </div>
              <div class="grid md:grid-cols-3 gap-6 mt-6">
                <div>
                  <h3 class="text-sm text-zinc-300 mb-2">Specs</h3>
                  ${specs}
                </div>
                <div>
                  <h3 class="text-sm text-zinc-300 mb-2">Pricing</h3>
                  ${pricing}
                </div>
                <div>
                  <h3 class="text-sm text-zinc-300 mb-2">Features</h3>
                  ${features}
                </div>
              </div>
              <div class="mt-6">
                <h3 class="text-sm text-zinc-300 mb-2">Instances</h3>
                ${instances ? `<div class="overflow-x-auto"><table class="table w-full text-sm">
                  <thead class="text-zinc-400"><tr>
                    <th class="py-2 pr-3 text-left">ID</th>
                    <th class="py-2 pr-3 text-left">Statut</th>
                    <th class="py-2 pr-3 text-left">Nom</th>
                    <th class="py-2 pr-3 text-left">Hostname</th>
                    <th class="py-2 pr-3 text-left">User</th>
                    <th class="py-2 text-left">Créée</th>
                  </tr></thead>
                  <tbody>${instances}</tbody>
                </table></div>` : '<div class="text-zinc-500 text-sm">Aucune instance.</div>'}
              </div>
            </section>
          `;
        }).join('');
      }

      load();
    </script>
  </body>
  </html>

